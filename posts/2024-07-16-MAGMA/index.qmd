---
title: "MAGMA: How does the SNP-wise Gene and the Gene-Set analysis operate?"
description: |
  Global overview of MAGMA Gene and Gene-Set analysis and 
author:
  - name: Daianna Gonzalez-Padilla
date: 2024-07-16
categories:
  - "GWAS"
  - "Gene analysis"
  - "Gene Set Enrichment"
  - "SNP summary statistics"
image: "images/logo.png"
bibliography: references.bib
---

# Introduction

MAGMA¬†stands for¬†**Multi-marker Analysis of GenoMic Annotation**¬†and is a computational tool for the analysis of the joint effect of multiple genetic markers on a phenotype based on Genome-Wide Association Study (GWAS) data. MAGMA constitutes a flexible and generalizable approach to assess the¬†**association**¬†of¬†[**individual genes**]{.underline}¬†or¬†[**gene-sets**]{.underline}¬†with a¬†**phenotype**¬†based on the associations that the¬†[**SNPs**]{.underline}¬†of the genes have with the same phenotype.

This is a commonly used method that you'll likely find implemented while reading about GWASes or that you'll need to run if working with genetic variant associations and gene-set enrichment analysis, so let's see how it works.

# What you'll learn here

1.  Global description of the analyses MAGMA allows to run at gene and gene-set levels.

2.  A more detailed demonstration of the SNP-wise gene analysis implemented in MAGMA: inputs, commands and outputs ‚Ä¶.

3.  TODO

# How does it work?

MAGMA allows to first perform a gene analysis and subsequently a gene-set analysis based on gene-level results. Note, however, that the gene-set analysis comes as a separate layer and it is an additional optional step, though it is frequently performed and quite useful.

## **Gene analysis**

Genetic markers are aggregated to the level of whole individual genes and those in a given gene are jointly tested for their association with the phenotype, defining in such way the association of the gene itself. This definitely allows to detect significant associations of multiple small-effect markers in a gene that individually would be missed, i.e., associations that depend on multiple markers. This also reduces the number of required tests and makes the results more interpretable by summarizing at the gene level.

Two alternatives for gene analysis are offered by MAGMA:

### [**Multiple linear PC regression model**]{style="color:#FF7256"}

If the input data is **raw genotype data**, MAGMA fits a multiple linear PC regression model to the individuals' phenotypes. Here, for one gene $g$ at a time, the SNP matrix that contains the information of the SNPs for that gene across all the $N$ individuals studied, is projected onto its Principal Components (PCs). These PCs capture genotypic differences between individuals for the given gene and the first $K$ most explanatory ones (comprising 99.9% of the variance) are used as predictors of the phenotype ($Y$) in the linear model.

![](images/MAGMA_PC_model.png){width="1500"}

Phenotype is modeled as:

$$
Y = \alpha_{0g}+X^*_{g}\alpha_g+W\beta_g+\epsilon_g
$$

$$
{\begin{bmatrix}Y_1 \\ ... \\ Y_{N-1} \\ Y_N\end{bmatrix}} = {\begin{bmatrix}\alpha_{0g} \\ ... \\ \alpha_{0g} \\ \alpha_{0g}\end{bmatrix}} + \stackrel{PC1 \ \  \ \  \ \ PC2 \ \  \ \  \ \ ...  \ \ \ \ \ \ PC_K} {\begin{bmatrix}  x_{11} \ \ x_{12} \ \ ... \ \ x_{1K}  \\  ... \\ x_{(N-1)1} \ \ x_{(N-1)2} \ \ ... \ \ x_{(N-1)K} \\  x_{N1} \ \ x_{N2} \ \ ... \ \ x_{NK} \end{bmatrix}} {\begin{bmatrix}\alpha_{g1} \\  \alpha_{g2} \\ ... \\ \alpha_{gK}\end{bmatrix}} + \stackrel{Cov1 \ \  \ \  \ \ Cov2 \ \  \ \  \ \ ...  \ \ \ \ \ \ CovL}{\begin{bmatrix}  w_{11} \ \ w_{12} \ \ ... \ \ w_{1L}  \\  ... \\ w_{(N-1)1} \ \ w_{(N-1)2} \ \ ... \ \ w_{(N-1)L} \\  w_{N1} \ \ w_{N2} \ \ ... \ \ w_{NL} \end{bmatrix}}{\begin{bmatrix}\beta_{g1} \\  \beta_{g2} \\ ... \\ \beta_{gL}\end{bmatrix}} +
{\begin{bmatrix}\epsilon_{g1} \\ ... \\ \epsilon_{g(N-1)} \\  \epsilon_{gN}\end{bmatrix}}
$$

With $X_{g}^*$ the matrix of the first $K$ PCs for gene $g$ and $W$ a matrix of additional covariates for the individuals that can be included in the model. $\alpha_g$'s and $\beta_g$'s are the coefficients of the PCs and covariates for the gene $g$, respectively. $\epsilon_g$ is the vector of residuals and $\alpha_{0g}$ the intercept. The $\alpha_g$'s represent the effect of the genotype for gene $g$ on the phenotype (the **genetic effect**).

Then an F-test is used to assess if genotypes for gene $g$ have an effect on the phenotype under the null hypothesis that the genetic effect of $g$ on the phenotype is 0 across all PCs ($H_0:\alpha_g=\overrightarrow 0$). This leads to a *p*-value for the association of gene $g$ with the phenotype $Y$ based on its genetic markers.

::: {style="background-color:#F2F2F2; padding: 15px"}
‚úîÔ∏è The advantage of using PCs instead of variables for individual SNPs is that 1) the number of variables included in the linear model is reduced and 2) they allow to account for redundancy and collinearity between SNPs. Also this model offers flexibility to accommodate additional covariates to model the phenotype.
:::

### [**SNP-wise gene analysis**]{style="color:#7AC5CD"}

If no raw genotype data is available, MAGMA also accepts [**SNP *p*-values**]{.underline} from a GWAS as input. In this case, such SNP *p*-values are first transformed into [**Z or** $\chi^2$ **statistics**]{.underline} and aggregated at the gene level (by the [**mean SNP statistic**]{style="background-color: #F0FFF0"} or [**top SNP statistic**]{style="background-color:#FFF0F5"} method) to obtain [**one test-statistic per gene**]{.underline} which is then used to compute the [**gene *p*-value**]{.underline}, either by an approximation of the sampling distribution (mean SNP statistic method) or by phenotype permutation (top SNP statistic method).

<div>

Summary: SNP *p*-values ‚Üí SNP statistics ‚Üí\* gene tets-statistic ‚Üí gene *p*-value ‚Üí gene *z*-score ($z_g$)

</div>

\*\*\*\*\* Gene test-statistics can be constructed from the SNP statistics (or *p*-values) applying one of two (main) implemented methods in MAGMA:

-   **Mean SNP statistic**: the mean (weighted sum) of SNP Z/\$\\chi\^2\$ statistics is used as the statistic of the gene. \*\*\*\*\*The¬†*p*-value of the gene is obtained based on a known¬†**approximation of the sampling distribution**. The \*\*\*\*reference data is only used to estimate the¬†**SNP statistic correlation matrix**. When using SNP Z-stats the mean of them is used, but for the mean \$\\chi\^2\$ method the sum of the -log(*p*-values) of the SNPs of the gene are used as the gene stats that follow a \$\\sim c\\chi\^2\_{(f)}\$.

-   **Top SNP statistic**: the lowest SNP¬†*p*-value for the gene (of the most associated SNP) or the sum of the -log(*p*-values) for the top most associated SNP is used as the gene statistic. A permutation procedure is applied assigning random phenotypes to the reference data and an empirical¬†*p*-value for the gene is computed¬†**as the proportion of these resulting permuted top gene statistics that are higher than the observed top gene stats**\*: an¬†**empirical sampling distribution**¬†of the gene test-statistics is generated and the gene¬†*p*-value computed based on these reference data.¬†[\*\*ü§î](https://emojipedia.org/thinking-face)\*\*¬†*How are permuted gene statistics computed from reference data (with only SNP IDs)?*

-   Weighted mean of the top SNP statistics

## Gene-set analysis

By aggregating genes in groups of genes that share cellular or functional properties and evaluating their association with a phenotype, we can gain insights into the potential molecules, pathways, and tissues implicated in the phenotype's etiology.

Two gene-level regression models are implemented:

# Conclusion

# Relevant links

::: {style="background-color: #F8F8FF;  padding: 14px; margin-left: 0px; margin-bottom: 1px; font-size: 15px; line-height: 1.3"}
| üìë **Original publication for MAGMA:**
| de Leeuw, C. A., Mooij, J. M., Heskes, T., & Posthuma, D. (2015). MAGMA: generalized gene-set analysis of GWAS data.¬†*PLoS computational biology*,¬†*11*(4), e1004219. [https://doi.org/10.1371/journal.pcbi.1004219](https://doi.org/10.1371/journal.pcbi.1004219https://doi.org/10.1371/journal.pcbi.1004219)
:::

¬†

# References
